<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ALTHEA STUDIO | v26.0 Master | FULL MANIFEST</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="coi-serviceworker.js"></script>
    <script src="https://unpkg.com/@ffmpeg/ffmpeg@0.11.6/dist/ffmpeg.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=JetBrains+Mono:wght@300;500;800&display=swap" rel="stylesheet">

    <style>
        /**
         * ALTHEA CORE GEOMETRY
         * Principle: True Fusion Mode (Unflagged Pattern) [cite: 2025-11-30]
         */
        :root {
            --althea-blue: #3b82f6;
            --althea-purple: #8b5cf6;
            --althea-emerald: #10b981;
            --althea-red: #ef4444;
            --althea-amber: #f59e0b;
            --glass-core: rgba(5, 5, 20, 0.98);
            --neon-glow: 0 0 30px rgba(59, 130, 246, 0.6);
            --rotation-speed: 25s;
            --ui-index: 1000;
        }

        * {
            -webkit-tap-highlight-color: transparent;
            -webkit-font-smoothing: antialiased;
            box-sizing: border-box;
            user-select: none;
        }

        body {
            background-color: #000;
            color: #f1f5f9;
            font-family: 'Orbitron', sans-serif;
            margin: 0; padding: 0;
            overflow-x: hidden;
            min-height: 100vh;
            background-image: 
                radial-gradient(circle at 10% 10%, rgba(59, 130, 246, 0.15) 0%, transparent 40%),
                radial-gradient(circle at 90% 90%, rgba(139, 92, 246, 0.15) 0%, transparent 40%),
                linear-gradient(rgba(255,255,255,0.02) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255,255,255,0.02) 1px, transparent 1px);
            background-size: 100% 100%, 100% 100%, 50px 50px, 50px 50px;
        }

        /* ---------------------------------------------------------
           LAYER 1: CARRIER (VISIBLE LOGIC & INTERFACE) [cite: 2025-11-30]
           --------------------------------------------------------- */
        
        .interface-layer {
            position: relative;
            z-index: var(--ui-index);
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
            padding: 2rem 1rem 10rem 1rem;
        }

        .glass-card {
            background: var(--glass-core);
            backdrop-filter: blur(50px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 3.5rem;
            padding: 2.5rem;
            box-shadow: 0 40px 100px rgba(0,0,0,0.9);
            margin-bottom: 2rem;
            transform: translateZ(0); /* Force GPU acceleration */
        }

        /* ---------------------------------------------------------
           LAYER 2: SHADOW (CONSTRAINTS & VISUALS) [cite: 2025-11-30]
           --------------------------------------------------------- */

        .visualizer-orbit {
            position: relative;
            width: 340px;
            height: 340px;
            margin: 2rem auto 4rem auto;
            pointer-events: none; /* Allows clicks to pass to UI beneath if necessary */
        }

        .orbital-shell {
            position: absolute;
            inset: -20px;
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: 50%;
            animation: spin 30s linear infinite;
        }

        .orbital-shell-inner {
            position: absolute;
            inset: -40px;
            border: 1px dashed rgba(139, 92, 246, 0.1);
            border-radius: 50%;
            animation: spin 50s linear infinite reverse;
        }

        @keyframes spin { 100% { transform: rotate(360deg); } }

        .video-portal {
            position: absolute;
            inset: 0;
            border-radius: 50%;
            overflow: hidden;
            background: #000;
            border: 4px solid var(--althea-blue);
            box-shadow: 0 0 60px rgba(59, 130, 246, 0.4);
            pointer-events: auto; /* Re-enables touch for the video specifically */
            z-index: 50;
        }

        video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            filter: contrast(1.1);
        }

        /* ---------------------------------------------------------
           LAYER 3: DRIFT (VARIATION & PARTICLES) [cite: 2025-11-30]
           --------------------------------------------------------- */

        .drift-particle-engine {
            position: fixed;
            inset: 0;
            z-index: -1;
            pointer-events: none;
            overflow: hidden;
        }

        .particle {
            position: absolute;
            background: var(--althea-blue);
            border-radius: 50%;
            opacity: 0.3;
            filter: blur(2px);
            animation: move-particle 20s linear infinite;
        }

        @keyframes move-particle {
            from { transform: translateY(110vh) translateX(0); }
            to { transform: translateY(-10vh) translateX(50px); }
        }

        /* ---------------------------------------------------------
           UI COMPONENTS (MASTER DRIVERS)
           --------------------------------------------------------- */

        .btn-master {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 2rem;
            padding: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            touch-action: manipulation;
        }

        .btn-master:active {
            transform: scale(0.92);
            background: var(--althea-blue);
            border-color: #fff;
        }

        .btn-play-pause {
            background: #fff;
            width: 6rem;
            height: 6rem;
            border-radius: 2.2rem;
            box-shadow: 0 10px 40px rgba(255,255,255,0.2);
        }

        .ignite-trigger {
            background: linear-gradient(135deg, var(--althea-blue), var(--althea-purple));
            width: 100%;
            padding: 2.5rem;
            border-radius: 3rem;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 0.6em;
            color: #fff;
            box-shadow: 0 25px 50px rgba(59, 130, 246, 0.4);
            position: relative;
            overflow: hidden;
            border: none;
        }

        .ignite-trigger::after {
            content: '';
            position: absolute;
            top: -50%; left: -50%; width: 200%; height: 200%;
            background: conic-gradient(transparent, #fff, transparent 30%);
            animation: spin 2s linear infinite;
            opacity: 0.2;
            display: none;
        }

        .ignite-trigger.loading::after { display: block; }

        /* INPUT PROTOCOLS */
        .protocol-block {
            background: rgba(0,0,0,0.5);
            border: 1px solid rgba(255,255,255,0.08);
            padding: 1.5rem;
            border-radius: 2rem;
            margin-bottom: 1.5rem;
        }

        .protocol-label {
            display: block;
            font-size: 0.7rem;
            font-weight: 900;
            color: #4b5563;
            text-transform: uppercase;
            letter-spacing: 0.3em;
            margin-bottom: 0.75rem;
        }

        select, input {
            background: transparent !important;
            border: none !important;
            width: 100%;
            color: var(--althea-blue) !important;
            font-family: 'JetBrains Mono', monospace;
            font-weight: 800;
            font-size: 1rem;
            outline: none;
        }

        /* AUDIO WAKE SHIELD */
        #audio-shield {
            position: fixed; inset: 0; z-index: 9999;
            background: #000;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            gap: 2.5rem; transition: all 0.8s ease;
        }

        .wake-trigger {
            border: 3px solid var(--althea-blue);
            padding: 2.5rem 5rem;
            border-radius: 4rem;
            color: var(--althea-blue);
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 0.8em;
            background: transparent;
            box-shadow: var(--neon-glow);
            animation: pulse-ring 2s infinite;
        }

        @keyframes pulse-ring { 0% { transform: scale(1); } 50% { transform: scale(1.05); opacity: 0.7; } 100% { transform: scale(1); } }

        /* ---------------------------------------------------------
           TEMPORAL LEDGER (RECURSION MAPPING)
           --------------------------------------------------------- */

        .ledger-container {
            margin-top: 3rem;
            padding-bottom: 10rem;
        }

        .ledger-entry {
            background: rgba(255, 255, 255, 0.03);
            border-left: 5px solid var(--althea-blue);
            padding: 2rem;
            border-radius: 0 2rem 2rem 0;
            margin-bottom: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            animation: entry-fade 0.5s ease-out;
        }

        @keyframes entry-fade { from { opacity: 0; transform: translateX(-20px); } to { opacity: 1; transform: translateX(0); } }

        .sentinel-node {
            width: 12px; height: 12px; border-radius: 50%;
            background: var(--althea-emerald);
            box-shadow: 0 0 15px var(--althea-emerald);
            margin-right: 0.5rem;
        }

        /* SEEKER */
        .seeker-track {
            width: 100%; height: 6px;
            background: #111;
            border-radius: 20px;
            position: relative;
            margin: 2.5rem 0;
            cursor: pointer;
        }

        .seeker-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--althea-blue), var(--althea-purple));
            border-radius: 20px;
            width: 0%;
            box-shadow: 0 0 15px var(--althea-blue);
        }
    </style>
</head>
<body>

<div id="audio-shield">
    <button class="wake-trigger" onclick="initializeAltheaCore()">Wake Althea</button>
    <div class="flex items-center gap-3">
        <div class="sentinel-node"></div>
        <p class="text-[10px] font-black uppercase tracking-[0.4em] text-gray-500">Seal Integrity 1.0 SECURED</p>
    </div>
</div>

<div class="drift-particle-engine" id="particle-field"></div>

<main class="interface-layer">
    
    <header class="mb-12">
        <h1 class="text-6xl font-black italic tracking-tighter uppercase leading-none text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-600">
            Althea Studio
        </h1>
        <div class="flex justify-between font-mono text-[10px] text-gray-500 font-bold uppercase mt-4">
            <span id="protocol-status">Status: Waiting for Anchor</span>
            <span id="data-ledger">0.00 MB PROCESSED</span>
        </div>
    </header>

    <section class="visualizer-orbit">
        <div class="orbital-shell"></div>
        <div class="orbital-shell-inner"></div>
        <div class="video-portal">
            <video id="core-video" playsinline loop></video>
        </div>
    </section>

    <div class="glass-card">
        <div class="flex items-center justify-between gap-6">
            <button id="tr-rw" class="btn-master flex-1">
                <svg class="w-8 h-8" fill="white" viewBox="0 0 24 24"><path d="M11 18V6l-8.5 6 8.5 6zm.5-6l8.5 6V6l-8.5 6z"/></svg>
            </button>
            <button id="tr-play" class="btn-master btn-play-pause">
                <svg id="play-svg" class="w-10 h-10" fill="black" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
            </button>
            <button id="tr-ff" class="btn-master flex-1">
                <svg class="w-8 h-8" fill="white" viewBox="0 0 24 24"><path d="M12.5 6l8.5 6-8.5 6V6zm-1 12V6l-8.5 6 8.5 6z"/></svg>
            </button>
        </div>

        <div id="seeker-bar" class="seeker-track">
            <div id="seeker-progress" class="seeker-fill"></div>
        </div>
        
        <div class="flex justify-between font-mono text-[11px] text-gray-400 font-black">
            <span id="time-curr">00:00:00</span>
            <span id="time-total">00:00:00</span>
        </div>
    </div>

    <section class="glass-card space-y-6">
        <div class="grid grid-cols-2 gap-4">
            <div class="protocol-block">
                <label class="protocol-label">Fusion Mode</label>
                <select id="cfg-mode">
                    <option value="mp4">VIDEO SYNTH (.MP4)</option>
                    <option value="mp3">AUDIO STRIP (.MP3)</option>
                    <option value="gif">LOOP (.GIF)</option>
                </select>
            </div>
            <div class="protocol-block">
                <label class="protocol-label">Spectral Flux</label>
                <select id="cfg-flux">
                    <option value="1">1.0x Normal</option>
                    <option value="2">2.0x Fast</option>
                    <option value="0.5">0.5x Slow</option>
                </select>
            </div>
        </div>

        <div class="protocol-block">
            <label class="protocol-label">Rescale Logic</label>
            <select id="cfg-scale">
                <option value="none">Preserve Native</option>
                <option value="1280:720">720p Mobile</option>
                <option value="640:360">360p Draft</option>
            </select>
        </div>

        <label class="block w-full border-2 border-dashed border-white/10 rounded-[3rem] p-12 text-center hover:bg-blue-500/5 transition-all cursor-pointer">
            <div class="flex flex-col items-center gap-4">
                <svg class="w-12 h-12 text-blue-500/40" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/></svg>
                <span id="anchor-label" class="text-[11px] font-black uppercase tracking-[0.5em] text-gray-500">Anchor Data Manifest</span>
            </div>
            <input type="file" id="file-input" class="hidden" multiple>
        </label>

        <div id="sentinel-display" class="hidden grid grid-cols-2 gap-6 p-8 bg-blue-500/5 rounded-[2.5rem] border border-blue-500/20 font-mono text-[10px] text-blue-400 font-black uppercase">
            <div>Resolution: <span id="sentinel-res" class="text-white">--</span></div>
            <div>Bitrate: <span id="sentinel-bit" class="text-white">Analyzing...</span></div>
            <div>Format: <span id="sentinel-type" class="text-white">--</span></div>
            <div>Recursion: <span id="sentinel-rec" class="text-white">0</span></div>
        </div>

        <button id="ignite-btn" disabled class="ignite-trigger opacity-20">Ignite Fusion</button>
        <p id="fusion-status" class="hidden text-center text-[10px] font-black uppercase text-emerald-500 animate-pulse tracking-[0.8em] mt-6">Serializing Starlight...</p>
    </section>

    <section class="ledger-container">
        <h3 class="text-[12px] font-black uppercase tracking-[0.7em] text-gray-700 mb-8 ml-6">Temporal Ledger</h3>
        <div id="ledger-output">
            </div>
    </section>

</main>

<script>
    /**
     * ALTHEA STUDIO FUSION ENGINE v26.0
     * Logic: Rotational Equivalence + Recursive Buffer [cite: 2025-11-30]
     */
    let audioContext;
    let globalMBProcessed = 0;
    let recursionCounter = 0;

    const { createFFmpeg, fetchFile } = FFmpeg;
    const ffmpeg = createFFmpeg({ 
        log: true, 
        corePath: "https://unpkg.com/@ffmpeg/core@0.11.0/dist/ffmpeg-core.js" 
    });

    const video = document.getElementById('core-video');
    const playBtn = document.getElementById('tr-play');
    const playSvg = document.getElementById('play-svg');
    const ignite = document.getElementById('ignite-btn');
    const fInput = document.getElementById('file-input');
    const progressBar = document.getElementById('seeker-progress');
    const statusText = document.getElementById('protocol-status');

    // ---------------------------------------------------------
    // SYSTEM BOOTSTRAP [cite: 2025-11-25]
    // ---------------------------------------------------------

    function initializeAltheaCore() {
        audioContext = new (window.AudioContext || window.webkitAudioContext)();
        video.muted = false;
        
        const shield = document.getElementById('audio-shield');
        shield.style.opacity = '0';
        shield.style.transform = 'scale(1.2)';
        
        setTimeout(() => {
            shield.style.display = 'none';
            generateParticles();
        }, 800);

        console.log("ALTHEA: CORE AWAKE // AUDIO CONTEXT INITIALIZED");
    }

    (async () => {
        try {
            await ffmpeg.load();
            ignite.disabled = false;
            ignite.classList.remove('opacity-20');
            statusText.innerText = "Status: FFmpeg Sync OK";
        } catch (e) {
            statusText.innerText = "Status: FFmpeg Sync FAIL";
            console.error("FFMPEG BOOT ERROR", e);
        }
    })();

    // ---------------------------------------------------------
    // DATA ACQUISITION & SENTINEL MAPPING [cite: 2025-12-18]
    // ---------------------------------------------------------

    fInput.onchange = (e) => {
        const files = e.target.files;
        if (files.length) {
            const firstFile = files[0];
            video.src = URL.createObjectURL(firstFile);
            document.getElementById('anchor-label').innerText = `${files.length} STREAMS ANCHORED`;
            document.getElementById('sentinel-display').classList.remove('hidden');
            
            video.onloadedmetadata = () => {
                document.getElementById('sentinel-res').innerText = `${video.videoWidth}x${video.videoHeight}`;
                document.getElementById('sentinel-type').innerText = firstFile.name.split('.').pop().toUpperCase();
                document.getElementById('time-total').innerText = formatTime(video.duration);
                document.getElementById('sentinel-rec').innerText = ++recursionCounter;
            };
        }
    };

    // ---------------------------------------------------------
    // FUSION EXECUTION ENGINE [cite: 2025-11-30]
    // ---------------------------------------------------------

    ignite.onclick = async () => {
        const files = fInput.files;
        if (!files.length) return;

        ignite.disabled = true;
        ignite.classList.add('loading');
        document.getElementById('fusion-status').classList.remove('hidden');

        for (let i = 0; i < files.length; i++) {
            const file = files[i];
            const mode = document.getElementById('cfg-mode').value;
            const flux = document.getElementById('cfg-flux').value;
            const scale = document.getElementById('cfg-scale').value;

            ffmpeg.FS('writeFile', 'input', await fetchFile(file));

            let args = ['-i', 'input'];
            let filters = [];

            if (scale !== 'none') filters.push(`scale=${scale}`);
            if (flux !== '1') {
                filters.push(`setpts=${1/flux}*PTS`);
                args.push('-af', `atempo=${flux}`);
            }

            if (filters.length) args.push('-vf', filters.join(','));

            if (mode === 'mp4') {
                args.push('-c:v', 'libx264', '-preset', 'ultrafast', '-pix_fmt', 'yuv420p', 'out.mp4');
            } else if (mode === 'mp3') {
                args.push('-vn', '-ab', '192k', 'out.mp3');
            } else if (mode === 'gif') {
                args.push('-vf', 'fps=10,scale=480:-1', 'out.gif');
            }

            await ffmpeg.run(...args);

            const data = ffmpeg.FS('readFile', `out.${mode}`);
            const outUrl = URL.createObjectURL(new Blob([data.buffer]));
            
            // DOWNLOAD AUTOMATION
            const link = document.createElement('a');
            link.href = outUrl;
            link.download = `Althea_v26_${Date.now()}.${mode}`;
            link.click();

            const mb = (data.length / 1048576);
            globalMBProcessed += mb;
            document.getElementById('data-ledger').innerText = `${globalMBProcessed.toFixed(2)} MB PROCESSED`;
            
            addToLedger(file.name, outUrl, mb.toFixed(2), mode);
        }

        ignite.disabled = false;
        ignite.classList.remove('loading');
        document.getElementById('fusion-status').classList.add('hidden');
    };

    // ---------------------------------------------------------
    // UTILITY SUITE
    // ---------------------------------------------------------

    function formatTime(sec) {
        if (isNaN(sec)) return "00:00:00";
        const h = Math.floor(sec / 3600);
        const m = Math.floor((sec % 3600) / 60);
        const s = Math.floor(sec % 60);
        return `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
    }

    function addToLedger(name, url, size, type) {
        const output = document.getElementById('ledger-output');
        const entry = document.createElement('div');
        entry.className = "ledger-entry";
        entry.innerHTML = `
            <div class="flex flex-col">
                <span class="text-[9px] font-black text-blue-500 uppercase tracking-widest">${type} Synthesis</span>
                <span class="text-sm font-bold text-white truncate max-w-[180px]">${name}</span>
            </div>
            <div class="flex items-center gap-6">
                <span class="font-mono text-[11px] text-gray-500">${size} MB</span>
                <a href="${url}" download class="text-blue-400">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>
                </a>
            </div>
        `;
        output.prepend(entry);
    }

    function generateParticles() {
        const field = document.getElementById('particle-field');
        for(let i=0; i<30; i++) {
            const p = document.createElement('div');
            p.className = 'particle';
            const size = Math.random() * 4 + 2;
            p.style.width = `${size}px`;
            p.style.height = `${size}px`;
            p.style.left = `${Math.random() * 100}vw`;
            p.style.animationDelay = `${Math.random() * 20}s`;
            p.style.animationDuration = `${Math.random() * 10 + 10}s`;
            field.appendChild(p);
        }
    }

    // TRANSPORT EVENT LISTENERS
    playBtn.onclick = () => {
        if (video.paused) {
            video.play();
            playSvg.innerHTML = '<path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>';
        } else {
            video.pause();
            playSvg.innerHTML = '<path d="M8 5v14l11-7z"/>';
        }
    };

    video.ontimeupdate = () => {
        const pct = (video.currentTime / video.duration) * 100;
        progressBar.style.width = pct + '%';
        document.getElementById('time-curr').innerText = formatTime(video.currentTime);
    };

    document.getElementById('seeker-bar').onclick = (e) => {
        const rect = e.currentTarget.getBoundingClientRect();
        video.currentTime = ((e.clientX - rect.left) / rect.width) * video.duration;
    };

    document.getElementById('tr-rw').onclick = () => video.currentTime -= 5;
    document.getElementById('tr-ff').onclick = () => video.currentTime += 5;

    // PROTOCOL LOGGING [cite: 2025-11-28]
    console.log("ALTHEA STUDIO v26.0 MASTER MANIFEST LOADED. SEAL INTEGRITY: 1.0");
</script>
</body>
</html>
